(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6fd87afa"],{"7f5b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reserve-house"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"-1"!=t.$authority.indexOf("reserveRoomTable"),expression:"$authority.indexOf('reserveRoomTable') != '-1'"}],staticClass:"search-list"},[a("el-row",[a("el-col",{attrs:{span:22}},[t._e(),a("el-col",{attrs:{span:4}},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:6}},[t._v("\n                        项目\n                    ")]),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:t.searchChangeProject},model:{value:t.searchInfo.project,callback:function(e){t.$set(t.searchInfo,"project",e)},expression:"searchInfo.project"}},t._l(t.projectList,function(t){return a("el-option",{key:t.orgId,attrs:{label:t.orgName,value:t.orgId}})}),1)],1)],1),a("el-col",{attrs:{span:3}},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:6}},[t._v("\n                        房号\n                    ")]),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.searchInfo.roomNum,callback:function(e){t.$set(t.searchInfo,"roomNum",e)},expression:"searchInfo.roomNum"}},t._l(t.roomList,function(t){return a("el-option",{key:t.roomId,attrs:{label:t.roomName,value:t.roomId}})}),1)],1)],1),a("el-col",{attrs:{span:3}},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:6}},[t._v("\n                        户型\n                    ")]),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.searchInfo.doorType,callback:function(e){t.$set(t.searchInfo,"doorType",e)},expression:"searchInfo.doorType"}},t._l(t.apartmentList,function(t){return a("el-option",{key:t.val,attrs:{label:t.text,value:t.val}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:5}},[t._v("\n                        预约时间\n                    ")]),a("el-col",{attrs:{span:18}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetimerange","range-separator":"-","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchInfo.orderTime,callback:function(e){t.$set(t.searchInfo,"orderTime",e)},expression:"searchInfo.orderTime"}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:8}},[t._v("\n                        预约人信息\n                    ")]),a("el-col",{attrs:{span:15}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"预约人名称/手机号",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getTableList(e)}},model:{value:t.searchInfo.orderPerson,callback:function(e){t.$set(t.searchInfo,"orderPerson",e)},expression:"searchInfo.orderPerson"}})],1)],1)],1),a("el-col",{staticClass:"disp-right",attrs:{span:2}},[a("el-button",{staticClass:"el-button el-button--primary",on:{click:t.getTableList}},[t._v("查询")]),"-1"!=t.$authority.indexOf("reserveRoomExport")?a("el-button",{staticClass:"greenBtn",on:{click:t.exportSearchList}},[t._v("导出")]):t._e()],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"-1"!=t.$authority.indexOf("reserveRoomTable"),expression:"$authority.indexOf('reserveRoomTable') != '-1'"}],staticClass:"content-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{prop:"indexNum",align:"center",label:"序号",width:"80"}}),a("el-table-column",{attrs:{prop:"cityName",align:"center",label:"城市"}}),a("el-table-column",{attrs:{prop:"orgName",align:"center",label:"项目"}}),a("el-table-column",{attrs:{prop:"roomName",align:"center",label:"房号"}}),a("el-table-column",{attrs:{prop:"houseType",align:"center",label:"户型"}}),a("el-table-column",{attrs:{prop:"visitorName",align:"center",label:"预约人"}}),a("el-table-column",{attrs:{prop:"visitorPhone",align:"center",label:"住户电话"}}),a("el-table-column",{attrs:{prop:"visitTime",align:"center",label:"预约时间"}}),a("el-table-column",{attrs:{prop:"createTime",align:"center",label:"提交时间"}}),a("el-table-column",{attrs:{prop:"visitedName",align:"center",label:"是否看房"}}),a("el-table-column",{attrs:{prop:"reservedName",align:"center",label:"是否入住"}}),a("el-table-column",{attrs:{prop:"note",align:"center",label:"未入住原因"}}),a("el-table-column",{attrs:{prop:"noteTime",align:"center",label:"备注时间"}}),a("el-table-column",{attrs:{prop:"noterName",align:"center",label:"备注人员"}}),a("el-table-column",{attrs:{prop:"operator",align:"center",width:"140",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return["-1"!=t.$authority.indexOf("reserveRoomRemark")?a("span",{staticClass:"greenFont tabOperteBtn",on:{click:function(a){return t.enterWriteMark(e.row)}}},[t._v("备注")]):t._e()]}}])})],1)],1),t.dialogVisible?a("div",{staticClass:"my-puple"},[a("el-dialog",{attrs:{title:"备注",visible:t.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"660px","before-close":function(){return t.dialogVisible=!1}},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"my-puple-contract"},[a("el-row",{staticStyle:{"font-size":"14px"}},[a("el-col",{attrs:{span:5}},[t._v("是否看房")]),a("el-col",{attrs:{span:18}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.noteInfo.visited,callback:function(e){t.$set(t.noteInfo,"visited",e)},expression:"noteInfo.visited"}},t._l(t.visitedList,function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})}),1)],1)],1),a("el-row",{staticClass:"mt-10",staticStyle:{"font-size":"14px"}},[a("el-col",{attrs:{span:5}},[t._v("是否确定入住")]),a("el-col",{attrs:{span:18}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.noteInfo.reserved,callback:function(e){t.$set(t.noteInfo,"reserved",e)},expression:"noteInfo.reserved"}},t._l(t.visitedList,function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})}),1)],1)],1),a("el-row",{staticClass:"mt-10",staticStyle:{"font-size":"14px"}},[a("el-col",{staticClass:"is-required-a",attrs:{span:5}},[t._v("未选择入住原因")]),a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:4},placeholder:"请输入未选择入住原因(50字以内)",maxlength:"50"},model:{value:t.noteInfo.note,callback:function(e){t.$set(t.noteInfo,"note",e)},expression:"noteInfo.note"}})],1)],1)],1),a("span",{staticClass:"dialog-footer mt-10",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.comfirmSubmitMark}},[t._v("确定")]),a("el-button",{staticClass:"greenBtn",on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)])],1):t._e(),a("div",{staticClass:"el-page"},[a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)])},r=[],o=a("90b9"),i={name:"reserve-house",data(){return{currentPage:1,dialogVisible:!1,searchInfo:{city:"",project:"",roomNum:"",doorType:"",orderTime:[],orderPerson:""},noteInfo:{roomVisitId:"",visited:"",reserved:"",note:""},visitedList:[{name:"是",value:"1"},{name:"否",value:"0"}],cityList:[],projectList:[],roomList:[],apartmentList:[],currentPage:1,pageSize:10,total:10,tableData:[]}},created(){this.getStoreDataList(),this.getPeojectList()},mounted(){},watch:{"$store.getters.getRoomNumList"(){this.roomList=this.$store.getters.getRoomNumList||[]},"$store.getters.gettaCity"(){this.cityList=this.$store.getters.gettaCity||[]},"$store.getters.getApartmentList"(){this.apartmentList=this.$store.getters.getApartmentList||[]},"$store.getters.getStoreEdit.count"(){"project"==this.$store.getters.getStoreEdit.which&&this.changeCityChoice()}},methods:{getStoreDataList(){this.apartmentList=this.$store.getters.getApartmentList||[]},searchChangeProject(){this.projectList.length>0?(this.searchInfo.roomNum="",this.$store.dispatch("getRoomNum",`orgId=${this.searchInfo.project}`)):(this.searchInfo.roomNum="",this.roomList=[]),this.getTableList()},changeCityChoice(){this.searchInfo.project="",""!=this.searchInfo.city?this.getPeojectList():this.projectList=[]},getPeojectList(){this.$http.get("/api/visit/getOrgList").then(t=>{var e=t.data;if(0==e.errorCode){if(this.projectList=e.data||[],this.projectList.length>0){this.projectList.unshift({orgName:"全部",orgId:""}),this.searchInfo.project=this.projectList[0].orgId;var a=`orgId=${this.searchInfo.project}&orgType=1`;this.$store.dispatch("getRoomNum",a)}this.getTableList()}}).catch(function(t){console.log(t)})},handleSizeChange(t){this.currentPage=1,this.pageSize=t,this.getTableList()},handleCurrentChange(t){this.currentPage=t,this.getTableList()},exportSearchList(){var t=this.searchInfo.orderTime&&this.searchInfo.orderTime.length>0?this.searchInfo.orderTime[0]:"",e=this.searchInfo.orderTime&&this.searchInfo.orderTime.length>0?this.searchInfo.orderTime[1]:"",a=Object(o["m"])(this.searchInfo.orderPerson),s=`./api/visit/export?cityId=${this.searchInfo.city}&orgId=${this.searchInfo.project}\n            &roomId=${this.searchInfo.roomNum}&roomStructureId=${this.searchInfo.doorType}&visitTimeStart=${t}\n            &visitTimeEnd=${e}&nameOrPhone=${a}\n            &currentPage=${this.currentPage}&pageSize=${this.pageSize}`;window.open(s)},getTableList(){if(0==this.projectList.length)return this.total=0,void(this.tableData=[]);var t={cityId:this.searchInfo.city,orgId:this.searchInfo.project,roomId:this.searchInfo.roomNum,roomStructureId:this.searchInfo.doorType,visitTimeStart:this.searchInfo.orderTime&&this.searchInfo.orderTime.length>0?this.searchInfo.orderTime[0]:"",visitTimeEnd:this.searchInfo.orderTime&&this.searchInfo.orderTime.length>0?this.searchInfo.orderTime[1]:"",nameOrPhone:Object(o["m"])(this.searchInfo.orderPerson),currentPage:this.currentPage,pageSize:this.pageSize};this.$http.get("/api/visit/page",{params:t}).then(t=>{var e=t.data;if(0==e.errorCode){this.total=e.data.total,this.tableData=e.data.content;for(let t=0;t<this.tableData.length;t++)this.tableData[t].cityName=this.tableData[t].cityName||"-",this.tableData[t].orgName=this.tableData[t].orgName||"-",this.tableData[t].roomName=this.tableData[t].roomName||"-",this.tableData[t].houseType=this.tableData[t].houseType||"-",this.tableData[t].visitorName=this.tableData[t].visitorName||"-",this.tableData[t].visitorPhone=this.tableData[t].visitorPhone||"-",this.tableData[t].createTime=this.tableData[t].createTime||"-",this.tableData[t].visitTime=this.tableData[t].visitTime||"-",this.tableData[t].note=this.tableData[t].note||"-",this.tableData[t].noteTime=this.tableData[t].noteTime||"-",this.tableData[t].noterName=this.tableData[t].noterName||"-",this.tableData[t].visitedName=1==this.tableData[t].visited?"是":"否",this.tableData[t].reservedName=1==this.tableData[t].reserved?"是":"否",this.tableData[t].indexNum=Number(this.pageSize)*Number(this.currentPage-1)+Number(1+t)}}).catch(function(t){console.log(t)})},enterWriteMark(t){this.dialogVisible=!0,this.noteInfo.roomVisitId=t.roomVisitId},comfirmSubmitMark(){if(""==this.noteInfo.note)return this.$message({message:"请输入备注！",type:"error"});this.$http.post("/api/visit/note/add",{roomVisitId:this.noteInfo.roomVisitId,visited:this.noteInfo.visited,reserved:this.noteInfo.reserved,note:this.noteInfo.note}).then(t=>{var e=t.data;0==e.errorCode&&setTimeout(()=>{this.$message({message:"备注成功！",type:"success"}),this.dialogVisible=!1,this.getTableList()},1e3)}).catch(function(t){console.log(t)})}}},l=i,n=(a("89a6"),a("6691")),c=Object(n["a"])(l,s,r,!1,null,null,null);e["default"]=c.exports},"81b5":function(t,e,a){},"89a6":function(t,e,a){"use strict";var s=a("81b5"),r=a.n(s);r.a}}]);
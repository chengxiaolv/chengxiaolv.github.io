(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02c7e01e"],{"4f80":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contract-management"},[a("div",{staticClass:"header-condition"},t._l(t.statusList,function(e,o){return a("span",{key:o,class:{"is-active":t.contractInfo.status==e.val},on:{click:function(a){return t.choiceSearchRoomStatus(e)}}},[t._v(t._s(e.text||"")+"("+t._s(e.count||0)+")")])}),0),a("div",{directives:[{name:"show",rawName:"v-show",value:"-1"!=t.$authority.indexOf("manageTable"),expression:"$authority.indexOf('manageTable') != '-1'"}],staticClass:"search-list"},[a("el-row",[a("el-col",{attrs:{span:24}},[t._e(),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"tr-10",attrs:{span:6}},[t._v("\n                        项目\n                    ")]),a("el-col",{attrs:{span:14}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:t.searchChangeProject},model:{value:t.contractInfo.project,callback:function(e){t.$set(t.contractInfo,"project",e)},expression:"contractInfo.project"}},t._l(t.projectList,function(t){return a("el-option",{key:t.orgId,attrs:{label:t.orgName,value:t.orgId}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"tr-10",attrs:{span:6}},[t._v("\n                        房号\n                    ")]),a("el-col",{attrs:{span:14}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.contractInfo.roomNum,callback:function(e){t.$set(t.contractInfo,"roomNum",e)},expression:"contractInfo.roomNum"}},t._l(t.roomList,function(t){return a("el-option",{key:t.roomId,attrs:{label:t.roomName,value:t.roomId}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"tr-10",attrs:{span:6}},[t._v("\n                        户型\n                    ")]),a("el-col",{attrs:{span:14}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.contractInfo.doorType,callback:function(e){t.$set(t.contractInfo,"doorType",e)},expression:"contractInfo.doorType"}},t._l(t.apartmentList,function(t){return a("el-option",{key:t.val,attrs:{label:t.text,value:t.val}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"tr-10",attrs:{span:6}},[t._v("\n                        签约时间\n                    ")]),a("el-col",{attrs:{span:14}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","default-time":["00:00:00","23:59:59"],"end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.contractInfo.signatureTime,callback:function(e){t.$set(t.contractInfo,"signatureTime",e)},expression:"contractInfo.signatureTime"}})],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"tr-10",attrs:{span:6}},[t._v("\n                        付款方式\n                    ")]),a("el-col",{attrs:{span:14}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.contractInfo.payWay,callback:function(e){t.$set(t.contractInfo,"payWay",e)},expression:"contractInfo.payWay"}},t._l(t.roomDeliveryMethod,function(t){return a("el-option",{key:t.val,attrs:{label:t.text,value:t.val}})}),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-col",{staticClass:"tr-10",staticStyle:{height:"60px",overflow:"hidden"},attrs:{span:6}},[t._v("\n                        承租人信息\n                    ")]),a("el-col",{attrs:{span:14}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入承租人名称、租客/居住姓名/手机",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getContractTable(e)}},model:{value:t.contractInfo.rentPerson,callback:function(e){t.$set(t.contractInfo,"rentPerson",e)},expression:"contractInfo.rentPerson"}})],1)],1),a("el-col",{attrs:{span:6,offset:6}},[a("el-col",{staticClass:"disp-right",attrs:{span:20}},[a("el-button",{staticClass:"el-button el-button--primary",on:{click:t.getContractTable}},[t._v("查询")]),"-1"!=t.$authority.indexOf("manageExport")?a("el-button",{staticClass:"greenBtn",on:{click:t.exportSearchList}},[t._v("导出")]):t._e()],1)],1)],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"-1"!=t.$authority.indexOf("manageTable"),expression:"$authority.indexOf('manageTable') != '-1'"}],staticClass:"content-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.contractTableData,border:""}},[a("el-table-column",{attrs:{prop:"indexNum",align:"center",label:"序号",width:"80"}}),a("el-table-column",{attrs:{prop:"contractNo",align:"center",label:"合同编号"}}),a("el-table-column",{attrs:{prop:"statusName",align:"center",label:"状态"}}),a("el-table-column",{attrs:{prop:"roomName",align:"center",width:"190",label:"城市-项目-房间号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[a("span",[t._v(t._s(e.row.cityName||"-"))]),t._v("-\n                      "),a("span",[t._v(t._s(e.row.orgName||"-"))]),t._v("-\n                      "),a("span",[t._v(t._s(e.row.roomName||"-"))])])]}}])}),a("el-table-column",{attrs:{prop:"typeName",align:"center",label:"合同类型"}}),a("el-table-column",{attrs:{prop:"houseType",align:"center",label:"户型"}}),a("el-table-column",{attrs:{prop:"lesseeName",align:"center",label:"承租人"}}),a("el-table-column",{attrs:{prop:"duringRent",align:"center",label:"租期"}}),a("el-table-column",{attrs:{prop:"signTime",align:"center",label:"签约时间"}}),a("el-table-column",{attrs:{prop:"rental",align:"center",label:"月租"}}),a("el-table-column",{attrs:{prop:"deposit",align:"center",label:"押金"}}),a("el-table-column",{attrs:{prop:"deliveryMethodName",align:"center",label:"付款方式"}}),a("el-table-column",{attrs:{prop:"operator",align:"center",width:"140",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return["4"==e.row.status&&"-1"!=t.$authority.indexOf("manageSigning")?a("span",{staticClass:"greenFont tabOperteBtn",on:{click:function(a){return t.enterCustomerSigning(e.row)}}},[t._v("签约")]):t._e(),"1"!=e.row.status&&"2"!=e.row.status&&"3"!=e.row.status&&"5"!=e.row.status||"-1"==t.$authority.indexOf("manageDetail")?t._e():a("span",{staticClass:"greenFont tabOperteBtn",on:{click:function(a){return t.enterCustomerSigningDetail(e.row)}}},[t._v("合同详情")]),"2"!=e.row.status&&"5"!=e.row.status||"-1"==t.$authority.indexOf("manageExitRent")?t._e():a("span",{staticClass:"greenFont tabOperteBtn",on:{click:function(a){return t.enterCustomerExitRent(e.row)}}},[t._v("退租")]),"2"!=e.row.status&&"5"!=e.row.status||"-1"==t.$authority.indexOf("manageRent")||""!=e.row.contractExtensionId&&void 0!=e.row.contractExtensionId?t._e():a("span",{staticClass:"greenFont tabOperteBtn",on:{click:function(a){return t.enterCustomerSigningExtend(e.row)}}},[t._v("续租")]),"1"!=e.row.status&&"3"!=e.row.status&&"4"!=e.row.status||"-1"==t.$authority.indexOf("deleteContract")?t._e():a("span",{staticClass:"greenFont tabOperteBtn",on:{click:function(a){return t.enterCustomerSigningDelete(e.row)}}},[t._v("删除")])]}}])})],1)],1),a("div",{staticClass:"el-page"},[a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,30,40,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t.dialogCustomerExit?a("div",{staticClass:"my-puple-contract"},[a("el-dialog",{attrs:{title:t.customerExitInfo.title||"租客退租结算",visible:t.dialogCustomerExit,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"1160px","before-close":function(){return t.dialogCustomerExit=!1}},on:{"update:visible":function(e){t.dialogCustomerExit=e}}},[a("el-row",[a("el-row",{staticClass:"each-item"},[a("el-col",{attrs:{span:22}},[a("div",{staticClass:"is-required-b font-title"},[t._v("房间信息："),t.customerExitInfo.roomExtended?a("span",{staticStyle:{color:"#f3893b"}},[t._v("（当前房间已被续租"),t.customerExitInfo.depositTransfer?a("span",[t._v("，押金转移到下一份合同")]):t._e(),t._v("）")]):t._e()]),a("div",[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"小区名称，房间号",clearable:"",readonly:""!=t.customerExitInfo.roomInfo},model:{value:t.customerExitInfo.roomInfo,callback:function(e){t.$set(t.customerExitInfo,"roomInfo",e)},expression:"customerExitInfo.roomInfo"}})],1)])],1),a("el-row",{staticClass:"each-item"},[a("el-col",{attrs:{span:22}},[a("div",{staticClass:"is-required-b font-title"},[t._v("合同类型：")]),a("div",{staticStyle:{height:"40px","line-height":"40px"}},[a("el-col",{attrs:{span:2}},[t._v("合同周期")]),a("el-col",{attrs:{span:8}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.customerExitInfo.contractTime,callback:function(e){t.$set(t.customerExitInfo,"contractTime",e)},expression:"customerExitInfo.contractTime"}})],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[t._v("租金/月")]),a("el-col",{attrs:{span:5}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"",clearable:""},model:{value:t.customerExitInfo.rentPrice,callback:function(e){t.$set(t.customerExitInfo,"rentPrice",e)},expression:"customerExitInfo.rentPrice"}})],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[t._v("押金")]),a("el-col",{attrs:{span:5}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"",clearable:"",readonly:""},model:{value:t.customerExitInfo.payMoney,callback:function(e){t.$set(t.customerExitInfo,"payMoney",e)},expression:"customerExitInfo.payMoney"}})],1)],1)]),a("el-col",{staticStyle:{"margin-top":"10px",height:"40px","line-height":"40px"},attrs:{span:22}},[a("el-col",{attrs:{span:6}},[a("el-radio-group",{model:{value:t.customerExitInfo.leaveMode,callback:function(e){t.$set(t.customerExitInfo,"leaveMode",e)},expression:"customerExitInfo.leaveMode"}},[a("el-radio",{attrs:{label:1}},[t._v("正常退租")]),a("el-radio",{attrs:{label:0}},[t._v("非正常退租")])],1)],1),0==t.customerExitInfo.leaveMode?a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:4}},[t._v("预计离房时间")]):t._e(),a("el-col",{attrs:{span:6}},[0==t.customerExitInfo.leaveMode?a("div",[t._v(t._s(t.customerExitInfo.leaveTime))]):t._e()])],1)],1),a("el-row",{staticClass:"each-item person-info"},[a("el-col",{attrs:{span:22}},[a("div",{staticClass:"is-required-b font-title"},[t._v("退款详情：")]),t._l(t.exitBackMoneyList,function(e,o){return a("div",{key:o,staticStyle:{height:"40px","line-height":"40px","margin-bottom":"10px"}},[a("el-col",{attrs:{span:3}},[a("div",{staticClass:"choice-exit-type"},[a("div",{class:{"is-choice":1==e.income.val},on:{click:function(e){return t.choiceMoneyType("1",o)}}},[t._v("收")]),a("div",{class:{"is-choice":0==e.income.val},on:{click:function(e){return t.choiceMoneyType("0",o)}}},[t._v("支")])])]),a("el-col",{attrs:{span:3}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"类型"},model:{value:e.type.val,callback:function(a){t.$set(e.type,"val",a)},expression:"item.type.val"}},t._l(t.exitBillList,function(t){return a("el-option",{key:t.val,attrs:{label:t.text,value:t.val}})}),1)],1),a("el-col",{staticStyle:{"padding-left":"20px"},attrs:{span:4}},[a("el-col",{attrs:{span:3}},[t._v("共")]),a("el-col",{attrs:{span:18}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"",clearable:""},on:{blur:t.calculateExitMoneyFunc},model:{value:e.price,callback:function(a){t.$set(e,"price",a)},expression:"item.price"}})],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:3}},[t._v("元")])],1),a("el-col",{attrs:{span:t.customerExitInfo.isPerson?10:9}},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:8}},[t._v("费用周期")]),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:16}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.exitBackMoneyList[o].duringTime,callback:function(e){t.$set(t.exitBackMoneyList[o],"duringTime",e)},expression:"exitBackMoneyList[index].duringTime"}})],1)],1),t.customerExitInfo.isPerson?t._e():a("el-col",{staticClass:"pl-10",attrs:{span:3}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择企业"},on:{change:t.choiceBackMoneyType},model:{value:e.historyContactId,callback:function(a){t.$set(e,"historyContactId",a)},expression:"item.historyContactId"}},t._l(t.exitContactList,function(t){return a("el-option",{key:t.historyContactId,attrs:{label:t.name,value:t.historyContactId}})}),1)],1),a("el-col",{attrs:{span:2}},[a("i",{staticClass:"el-icon-remove-outline",on:{click:function(e){return t.removeBackMoneyList(o)}}}),o==t.exitBackMoneyList.length-1?a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.insertBackMoneyList}}):t._e()])],1)})],2),t.customerExitInfo.isPerson?t._e():a("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:22}},[a("div",[a("el-col",{attrs:{span:2}},[t._v("企业备注：")]),a("el-col",{attrs:{span:20}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"",clearable:""},model:{value:t.customerExitInfo.enterpriseLabel,callback:function(e){t.$set(t.customerExitInfo,"enterpriseLabel",e)},expression:"customerExitInfo.enterpriseLabel"}})],1)],1)]),a("el-col",{attrs:{span:22}},[t._e(),a("div",[a("el-col",{attrs:{span:2}},[t._v("个人备注：")]),a("el-col",{attrs:{span:20}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"",clearable:""},model:{value:t.customerExitInfo.personLabel,callback:function(e){t.$set(t.customerExitInfo,"personLabel",e)},expression:"customerExitInfo.personLabel"}})],1)],1)]),a("el-col",{attrs:{span:22}},[t.customerExitInfo.isPerson?t._e():a("p",[t._v("向企业支付总金额（由财务进行线下付款）："),a("span",{staticClass:"red-font"},[t._v(t._s(t.customerExitInfo.totalEnterpMoney||0))]),a("span",{staticClass:"init-font-color"},[t._v(" (正数为收入, 负数为支出)")])])]),t.customerExitInfo.isPerson?t._e():a("el-col",{attrs:{span:22}},[a("div",{staticStyle:{height:"80px"}},[a("el-upload",{attrs:{action:"",multiple:!0,"before-upload":t.exitRoomUploadImgPreview,accept:"image"}},[a("div",{staticClass:"input-pic-box show-row",on:{click:function(e){return t.getUploadImgMode("enterprise")}}},[a("i",{staticClass:"el-icon-picture-outline"}),a("span",[t._v("添加企业附件")])])])],1)]),a("el-col",{attrs:{span:22}},t._l(t.exitEnterpriseUploadImgList,function(e,o){return a("el-col",{key:o,staticClass:"mb-10",attrs:{span:8}},[a("div",{staticClass:"upload-img-box"},[a("i",{staticClass:"el-icon-close",on:{click:function(e){return t.removeExitUploadFile("enterprise",o)}}}),a("img",{attrs:{src:e.maxPic,alt:""}})])])}),1),a("el-col",{attrs:{span:22}},[a("p",[t._v("向个人支付总金额（由财务进行线下付款）："),a("span",{staticClass:"red-font"},[t._v(t._s(t.customerExitInfo.totalMoney||0))]),a("span",{staticClass:"init-font-color"},[t._v(" (正数为收入, 负数为支出)")])])]),a("el-col",{attrs:{span:22}},[a("div",{staticStyle:{height:"80px"}},[a("el-upload",{attrs:{action:"",multiple:!0,"before-upload":t.exitRoomUploadImgPreview,accept:"image"}},[a("div",{staticClass:"input-pic-box show-row",on:{click:function(e){return t.getUploadImgMode("person")}}},[a("i",{staticClass:"el-icon-picture-outline"}),a("span",[t._v("添加个人附件")])])])],1)]),a("el-col",{attrs:{span:22}},t._l(t.exitPersonUploadImgList,function(e,o){return a("el-col",{key:o,staticClass:"mb-10",attrs:{span:8}},[a("div",{staticClass:"upload-img-box"},[a("i",{staticClass:"el-icon-close",on:{click:function(e){return t.removeExitUploadFile("person",o)}}}),a("img",{attrs:{src:e.maxPic,alt:""}})])])}),1)],1)],1),a("div",{staticClass:"deep-bottom-box",staticStyle:{"margin-top":"26px"}},[a("el-button",{attrs:{type:"primary"},on:{click:t.comfrimCustomerExitSubmit}},[t._v("提 交")]),a("el-button",{staticClass:"greenBtn",on:{click:function(e){t.dialogCustomerExit=!1}}},[t._v("取 消")])],1)],1)],1):t._e()])},i=[],s=a("90b9"),n={name:"contract-management",data(){return{dialogCustomerExit:!1,contractInfo:{status:"-1",city:"",project:"",roomNum:"",doorType:"",signatureTime:[],payWay:"",rentPerson:""},cityList:[],projectList:[],apartmentList:[],roomDeliveryMethod:[],roomList:[],statusList:[],currentPage:1,pageSize:10,total:10,contractTableData:[],customerExitInfo:{title:"个人租客退租结算",isPerson:!0,whichMode:"person",roomExtended:!1,depositTransfer:!1,roomId:"",cityName:"",orgName:"",roomName:"",roomInfo:"",contractTime:"",contractStartTime:"",contractEndTime:"",rentPrice:"",payMoney:"",leaveMode:1,leaveTime:"",totalMoney:"",totalEnterpMoney:"",personLabel:"",enterpriseLabel:"",deleteId:[],contacts:[]},exitBillList:[],exitContactList:[],exitBackMoneyList:[],exitPersonUploadImgList:[],exitEnterpriseUploadImgList:[]}},created(){this.getStoreDataList(),this.getPeojectList(),this.getRoomDeliveryMethod()},watch:{"$store.getters.getRoomNumList"(){this.roomList=this.$store.getters.getRoomNumList||[]},"$store.getters.gettaCity"(){this.cityList=this.$store.getters.gettaCity||[]},"$store.getters.getApartmentList"(){this.apartmentList=this.$store.getters.getApartmentList||[]},"$store.getters.getStoreEdit.count"(){"project"==this.$store.getters.getStoreEdit.which?this.changeCityChoice():"contract"==this.$store.getters.getStoreEdit.which&&(this.getStatusList(),this.getContractTable())}},mounted(){},methods:{showDetailOfIncomeAndExpand(){this.dialogRoomInfo=!0,this.dialogCustomerExit=!1},handleSizeChange(t){this.currentPage=1,this.pageSize=t,this.getContractTable()},handleCurrentChange(t){this.currentPage=t,this.getContractTable()},getStoreDataList(){this.apartmentList=this.$store.getters.getApartmentList||[]},getStatusList(){this.projectList.length>0&&this.$http.get("/api/contract/status",{params:{orgId:this.contractInfo.project}}).then(t=>{var e=t.data;0==e.errorCode&&(this.statusList=e.data||[])}).catch(function(t){console.log(t)})},changeCityChoice(){this.contractInfo.project="",""!=this.contractInfo.city?this.getPeojectList():this.projectList=[]},getPeojectList(){this.$http.get("/api/contract/getOrgList").then(t=>{var e=t.data;if(0==e.errorCode){if(this.projectList=e.data||[],this.projectList.length>0){this.projectList.unshift({orgName:"全部",orgId:""}),this.contractInfo.project=this.projectList[0].orgId;var a=`orgId=${this.contractInfo.project}&orgType=1`;this.$store.dispatch("getRoomNum",a)}this.getContractTable(),this.getStatusList()}}).catch(function(t){console.log(t)})},getRoomDeliveryMethod(){this.$http.get("/api/room/getRoomDeliveryMethod").then(t=>{var e=t.data;0==e.errorCode&&(this.roomDeliveryMethod=e.data)}).catch(function(t){console.log(t)})},searchChangeProject(){var t=`orgId=${this.contractInfo.project}&orgType=1`;this.$store.dispatch("getRoomNum",t),this.contractInfo.roomNum="",this.getStatusList(),this.getContractTable()},choiceSearchRoomStatus(t){this.contractInfo.status=t.val,this.currentPage=1,this.getContractTable()},exportSearchList(){var t=2==this.contractInfo.signatureTime.length?this.contractInfo.signatureTime[0]:"",e=2==this.contractInfo.signatureTime.length?this.contractInfo.signatureTime[1]:"",a=Object(s["m"])(this.contractInfo.rentPerson),o=`./api/contract/export?cityId=${this.contractInfo.city}&orgId=${this.contractInfo.project}&roomId=${this.contractInfo.roomNum}\n            &structure=${this.contractInfo.doorType}&signDateStart=${t}&signDateEnd=${e}\n            &deliveryMethod=${this.contractInfo.payWay}&nameOrPhone=${a}&status=${this.contractInfo.status}\n            &currentPage=${this.currentPage}&pageSize=${this.pageSize}`;window.open(o)},getContractTable(){if(0==this.projectList.length)return this.total=0,void(this.contractTableData=[]);var t={cityId:this.contractInfo.city,orgId:this.contractInfo.project,roomId:this.contractInfo.roomNum,structure:this.contractInfo.doorType,signDateStart:this.contractInfo.signatureTime&&2==this.contractInfo.signatureTime.length?this.contractInfo.signatureTime[0]:"",signDateEnd:this.contractInfo.signatureTime&&2==this.contractInfo.signatureTime.length?this.contractInfo.signatureTime[1]:"",deliveryMethod:this.contractInfo.payWay,nameOrPhone:Object(s["m"])(this.contractInfo.rentPerson),status:this.contractInfo.status,currentPage:this.currentPage,pageSize:this.pageSize};this.$http.get("/api/contract/page",{params:t}).then(t=>{var e=t.data;if(0==e.errorCode){this.contractTableData=e.data.content,this.total=e.data.total;for(var a=0;a<this.contractTableData.length;a++)""!=this.contractTableData[a].contractStartTime&&(this.contractTableData[a].contractStartTime=this.contractTableData[a].contractStartTime.substring(0,10)),""!=this.contractTableData[a].contractEndTime&&(this.contractTableData[a].contractEndTime=this.contractTableData[a].contractEndTime.substring(0,10)),this.contractTableData[a].duringRent=this.contractTableData[a].contractStartTime+" - "+this.contractTableData[a].contractEndTime,this.contractTableData[a].indexNum=Number(this.pageSize)*Number(this.currentPage-1)+Number(1+a)}}).catch(function(t){console.log(t)})},exitRoomUploadImgPreview(t){const e=t.size/1024/1024<3;if(!e)return this.$message({message:"上传图片大小不能超过 3MB!",type:"error"});let a=new FormData;a.append("file",t),this.$http({method:"post",url:"./api/file/uploadthumbCompress",data:a}).then(e=>{var a=e.data;0==a.errorCode&&("person"==this.customerExitInfo.whichMode?this.exitPersonUploadImgList.push({id:a.data.id,minPic:a.data.thumb_1,maxPic:a.data.thumb_2,originPic:a.data.url,name:t.name}):this.exitEnterpriseUploadImgList.push({id:a.data.id,minPic:a.data.thumb_1,maxPic:a.data.thumb_2,originPic:a.data.url,name:t.name}))})},getUploadImgMode(t){this.customerExitInfo.whichMode=t},removeExitUploadFile(t,e){"person"==t?this.exitPersonUploadImgList.splice(e,1):this.exitEnterpriseUploadImgList.splice(e,1)},enterCustomerExitRent(t){this.customerExitInfo.title="1"!=t.lessee?"个人租客退租结算":"企业租客退租结算",this.customerExitInfo.isPerson="1"!=t.lessee,this.customerExitInfo.roomId=t.roomId,this.customerExitInfo.cityName=t.cityName,this.customerExitInfo.orgName=t.orgName,this.customerExitInfo.roomName=t.roomName,this.customerExitInfo.roomInfo=t.cityName+t.orgName+t.roomName,this.customerExitInfo.rentPrice=t.price,this.customerExitInfo.contractId=t.contractId,this.customerExitInfo.deleteId=[],this.customerExitInfo.personLabel="",this.customerExitInfo.enterpriseLabel="",this.exitPersonUploadImgList=[],this.exitEnterpriseUploadImgList=[],this.customerExitRoom()},enterCustomerSigning(t){1==t.status?this.$store.commit("setContractMode",{mode:"insert",count:1,contractId:"",roomId:t.roomId,reserveId:""}):this.$store.commit("setContractMode",{mode:"insert",count:1,contractId:t.contractId,roomId:"",reserveId:""})},customerExitRoom(){this.$http.get("/api/bill/findLease",{params:{contractId:this.customerExitInfo.contractId}}).then(t=>{var e=t.data;if(0==e.errorCode){this.dialogCustomerExit=!0,this.customerExitInfo.contractStartTime=e.data.startTime.substring(0,11),this.customerExitInfo.contractEndTime=e.data.endTime.substring(0,11),this.customerExitInfo.leaveTime=e.data.preTime.substring(0,11);var a=[];""!=this.customerExitInfo.contractStartTime&&this.customerExitInfo.contractEndTime&&(a.push(this.customerExitInfo.contractStartTime),a.push(this.customerExitInfo.contractEndTime),this.customerExitInfo.contractTime=a),this.customerExitInfo.rentPrice=e.data.rental,this.customerExitInfo.payMoney=e.data.deposit,this.customerExitInfo.roomExtended=!!(e.data.extendedContractId&&e.data.extendedContractId>0),this.customerExitInfo.depositTransfer=!(!e.data.transfer||1!=e.data.transfer.val),this.customerExitInfo.contacts=this.customerExitInfo.isPerson?[]:e.data.content[0].contacts,this.exitBackMoneyList=e.data.content||[];for(var o=0;o<this.exitBackMoneyList.length;o++){var i=this.exitBackMoneyList[o].startTime,s=this.exitBackMoneyList[o].endTime;this.exitBackMoneyList[o].startTime=i?i.substring(0,11):"",this.exitBackMoneyList[o].preOrPayTime=s?s.substring(0,11):"";var n=[];""!=i&&""!=s&&(n.push(i),n.push(s)),this.$set(this.exitBackMoneyList[o],"duringTime",n)}this.exitContactList=e.data.contacts||[],this.calculateExitMoneyFunc()}}).catch(function(t){console.log(t)}),this.getExitBillList()},getExitBillList(){this.$http.get("/api/bill/billDetailTypes").then(t=>{var e=t.data;0==e.errorCode&&(this.exitBillList=e.data)}).catch(function(t){console.log(t)})},removeBackMoneyList(t){this.exitBackMoneyList.length<=1||(this.exitBackMoneyList[t].billDetailId&&""!=this.exitBackMoneyList[t].billDetailId&&this.customerExitInfo.deleteId.push(this.exitBackMoneyList[t].billDetailId),this.exitBackMoneyList.splice(t,1),this.calculateExitMoneyFunc())},insertBackMoneyList(){this.customerExitInfo.isPerson?this.exitBackMoneyList.push({income:{val:1},price:"",type:{val:""},duringTime:"",historyContactId:"",billDetailId:""}):this.exitBackMoneyList.push({income:{val:1},price:"",type:{val:""},duringTime:"",historyContactId:"",billDetailId:"",contacts:this.customerExitInfo.contacts})},choiceBackMoneyType(){setTimeout(()=>{this.calculateExitMoneyFunc()},20)},calculateExitMoneyFunc(){var t=0,e=0;if(this.customerExitInfo.isPerson){for(a=0;a<this.exitBackMoneyList.length;a++)""!=this.exitBackMoneyList[a].price&&parseFloat(this.exitBackMoneyList[a].price)>0&&(1==this.exitBackMoneyList[a].income.val?t+=parseFloat(this.exitBackMoneyList[a].price):t-=parseFloat(this.exitBackMoneyList[a].price));t=parseFloat(t).toFixed(2),this.customerExitInfo.totalMoney=t}else{for(var a=0;a<this.exitBackMoneyList.length;a++)if(""!=this.exitBackMoneyList[a].price&&parseFloat(this.exitBackMoneyList[a].price)>0){for(var o=!1,i=0;i<this.exitBackMoneyList[a].contacts.length;i++)this.exitBackMoneyList[a].contacts[i].historyContactId==this.exitBackMoneyList[a].historyContactId&&(o=1==this.exitBackMoneyList[a].contacts[i].ascription);1==this.exitBackMoneyList[a].income.val?o?e+=parseFloat(this.exitBackMoneyList[a].price):t+=parseFloat(this.exitBackMoneyList[a].price):o?e-=parseFloat(this.exitBackMoneyList[a].price):t-=parseFloat(this.exitBackMoneyList[a].price)}t=parseFloat(t).toFixed(2),e=parseFloat(e).toFixed(2),this.customerExitInfo.totalEnterpMoney=e,this.customerExitInfo.totalMoney=t}},choiceMoneyType(t,e){var a={};a=1==t?{text:"收入",val:"1"}:{text:"支出",val:"0"},this.exitBackMoneyList[e].income=a,this.calculateExitMoneyFunc()},comfrimCustomerExitSubmit(){for(var t=[],e=[],a=0;a<this.exitBackMoneyList.length;a++)t.push({billDetailId:this.exitBackMoneyList[a].billDetailId||"",ascription:this.customerExitInfo.isPerson?0:1,name:"",type:this.exitBackMoneyList[a].type.val,income:this.exitBackMoneyList[a].income.val,price:this.exitBackMoneyList[a].price,startTime:this.exitBackMoneyList[a].duringTime&&2==this.exitBackMoneyList[a].duringTime.length?this.exitBackMoneyList[a].duringTime[0]:"",endTime:this.exitBackMoneyList[a].duringTime&&2==this.exitBackMoneyList[a].duringTime.length?this.exitBackMoneyList[a].duringTime[1]:""});for(a=0;a<this.exitPersonUploadImgList.length;a++)e.push(this.exitPersonUploadImgList[a].id);var o={roomId:this.customerExitInfo.roomId,contractId:this.customerExitInfo.contractId,normal:this.customerExitInfo.leaveMode,time:this.customerExitInfo.leaveTime,delBillDetailIds:this.customerExitInfo.deleteId,personInfo:this.customerExitInfo.personLabel,content:t,personImages:e};if(this.customerExitInfo.isPerson)o.perseonPrice=this.customerExitInfo.totalMoney,o.enterprisePrice="";else{o.enterprisePrice=this.customerExitInfo.totalEnterpMoney,o.perseonPrice=this.customerExitInfo.totalMoney,o.enterpriseInfo=this.customerExitInfo.enterpriseLabel;var i=[];for(a=0;a<this.exitEnterpriseUploadImgList.length;a++)i.push(this.exitEnterpriseUploadImgList[a].id);o.enterpriseImages=i}this.$http.post("/api/bill/lease",o).then(t=>{var e=t.data;0==e.errorCode&&setTimeout(()=>{this.$message({message:"退租成功！",type:"success"}),this.dialogCustomerExit=!1,this.getContractTable()},1e3)}).catch(function(t){console.log(t)})},enterCustomerSigningDetail(t){this.$store.commit("setContractMode",{mode:"detail",count:1,contractId:t.contractId,roomId:t.roomId})},enterCustomerSigningExtend(t){this.$store.commit("setContractMode",{mode:"extend",count:1,contractId:t.contractId,roomId:""})},enterCustomerSigningDelete(t){this.$confirm("确定删除该租客合同么？删除合同将会删除合同内所有的收支","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http.post("/api/contract/del",{contractId:t.contractId}).then(t=>{var e=t.data;0==e.errorCode&&setTimeout(()=>{this.$message({message:"删除成功！",type:"success"}),this.getContractTable()},1e3)}).catch(function(t){console.log(t)})}).catch(()=>{})}}},r=n,c=(a("eb68"),a("6691")),l=Object(c["a"])(r,o,i,!1,null,null,null);e["default"]=l.exports},"63de":function(t,e,a){},eb68:function(t,e,a){"use strict";var o=a("63de"),i=a.n(o);i.a}}]);
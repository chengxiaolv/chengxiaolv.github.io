(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a28594e"],{1778:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"advertisement"},["-1"!=e.$authority.indexOf("advTable")?a("div",{staticClass:"search-list"},[a("el-row",{attrs:{span:24}},[a("el-col",{attrs:{span:24}},[a("el-col",{attrs:{span:1}},[e._v("城市")]),a("el-col",{attrs:{span:2}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择城市"},on:{change:e.getAdvertisePage},model:{value:e.PeojectListvalue,callback:function(t){e.PeojectListvalue=t},expression:"PeojectListvalue"}},e._l(e.project,function(e){return a("el-option",{key:e.id,attrs:{label:e.cityName,value:e.id}})}),1)],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("发布时间")]),a("el-col",{attrs:{span:6}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"-","default-time":["00:00:00","23:59:59"],"start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.serchstartend,callback:function(t){e.serchstartend=t},expression:"serchstartend"}})],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("状态")]),a("el-col",{attrs:{span:2}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择状态"},model:{value:e.serchstate,callback:function(t){e.serchstate=t},expression:"serchstate"}},e._l(e.states,function(e){return a("el-option",{key:e.val,attrs:{label:e.text,value:e.val}})}),1)],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("广告标题")]),a("el-col",{attrs:{span:3}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入广告标题",clearable:""},model:{value:e.serchtitle,callback:function(t){e.serchtitle=t},expression:"serchtitle"}})],1),a("el-col",{staticClass:"disp-right",attrs:{span:4}},["-1"!=e.$authority.indexOf("advTable")?a("el-button",{staticClass:"el-button el-button--primary",on:{click:e.getAdvertisePage}},[e._v("查询")]):e._e(),"-1"!=e.$authority.indexOf("publishAdv")?a("el-button",{staticClass:"el-button el-button--primary",on:{click:function(t){return e.getAdvertiseView("add")}}},[e._v("发布广告")]):e._e()],1)],1)],1)],1):e._e(),"-1"!=e.$authority.indexOf("advTable")?a("div",{staticClass:"content-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"cell-click":e.cellclick}},[a("el-table-column",{attrs:{type:"index",align:"center",label:"序号",width:"80"}}),a("el-table-column",{attrs:{prop:"cityIds",align:"center",label:"所在城市"}}),a("el-table-column",{attrs:{prop:"title",align:"center",label:"广告标题"}}),a("el-table-column",{attrs:{prop:"place",align:"center",label:"广告位置"}}),a("el-table-column",{attrs:{prop:"clickNum",align:"center",label:"点击量"}}),a("el-table-column",{attrs:{prop:"createTime",align:"center",label:"上线时段"}}),a("el-table-column",{attrs:{prop:"advertiseStateEnum.text",align:"center",label:"状态"}}),a("el-table-column",{attrs:{prop:"sysUserName",align:"center",label:"发布人"}}),a("el-table-column",{attrs:{prop:"sysUserPhone",align:"center",label:"发布人手机号"}}),a("el-table-column",{attrs:{prop:"endTime",align:"center",label:"发布时间"}}),a("el-table-column",{attrs:{prop:"address",align:"center",width:"100",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["-1"!=e.$authority.indexOf("advEdit")?a("span",{staticClass:"greenFont tabOperteBtn"},[e._v("修改")]):e._e()]}}],null,!1,2412460313)})],1)],1):e._e(),a("div",{staticClass:"el-page"},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,40,50],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e.dialogVisible1?a("div",{staticClass:"my-puple"},[a("el-dialog",{attrs:{title:e.ModeTitle,visible:e.dialogVisible1,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"1000px","before-close":function(){return e.dialogVisible1=!1}},on:{"update:visible":function(t){e.dialogVisible1=t}}},[a("el-row",[a("el-row",{staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("广告标题")]),a("el-col",{attrs:{span:16}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入话题名称，2(含) ~ 20个字以内(含)",clearable:""},model:{value:e.cellData.advertise.title,callback:function(t){e.$set(e.cellData.advertise,"title",t)},expression:"cellData.advertise.title"}})],1)],1),a("el-row",{staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("发布城市")]),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.cellData.advertise.cityIds,callback:function(t){e.$set(e.cellData.advertise,"cityIds",t)},expression:"cellData.advertise.cityIds"}},e._l(e.project,function(e){return a("el-option",{key:e.id,attrs:{label:e.cityName,value:e.id}})}),1)],1)],1),a("el-row",{staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("上线时段")]),a("el-col",{attrs:{span:16}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:e.TimeStartandEnd,callback:function(t){e.TimeStartandEnd=t},expression:"TimeStartandEnd"}})],1)],1),a("el-row",{staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("轮播位置")]),a("el-col",{attrs:{span:16}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.cellData.advertise.place,callback:function(t){e.$set(e.cellData.advertise,"place",t)},expression:"cellData.advertise.place"}},e._l(e.carouselList,function(e){return a("el-option",{key:e.val,attrs:{label:e.text,value:e.val}})}),1)],1)],1),a("el-row",{staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("内容类型")]),a("el-col",{attrs:{span:16}},[a("el-radio-group",{model:{value:e.cellData.advertise.type,callback:function(t){e.$set(e.cellData.advertise,"type",t)},expression:"cellData.advertise.type"}},[a("el-radio",{attrs:{label:0}},[e._v("按内容")]),a("el-radio",{attrs:{label:1}},[e._v("按网址")])],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:0===e.cellData.advertise.type,expression:"cellData.advertise.type===0"}],staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("广告内容")]),a("el-col",{attrs:{span:16}},[a("Edio",{ref:"editor",attrs:{getValue:e.cellData.advertise.content}})],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:1===e.cellData.advertise.type,expression:"cellData.advertise.type===1"}],staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("网址")]),a("el-col",{attrs:{span:16}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入网址内容",clearable:""},model:{value:e.cellData.advertise.url,callback:function(t){e.$set(e.cellData.advertise,"url",t)},expression:"cellData.advertise.url"}})],1)],1),a("el-row",{staticClass:"each-item"},[a("el-col",{staticClass:"is-required-a",attrs:{span:4}},[e._v("图片")]),a("el-col",{attrs:{span:16}},[a("el-row",[a("el-upload",{attrs:{action:"","before-upload":e.success,accept:"image",multiple:!1,"show-file-list":!1}},[a("div",{staticClass:"input-pic-box"},[a("el-button",{staticClass:"upload-bg"},[e._v("上传图片")]),a("p",{staticClass:"hint"},[e._v("只能上传1张，支持png.jpg，尺寸690*345")])],1)])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:""!=e.cellData.imgFile.url,expression:"cellData.imgFile.url!=''"}],staticClass:"upload-img-box"},[a("i",{staticClass:"el-icon-close",on:{click:e.removeUploadImgOrigin}}),a("img",{attrs:{src:e.cellData.imgFile.thumb_1,alt:"",width:"216",height:"140"}})])],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.ModifyAdve}},[e._v("发 布")]),a("el-button",{staticClass:"greenBtn",on:{click:function(t){e.dialogVisible1=!1}}},[e._v("取 消")])],1)],1)],1):e._e(),(e.dialogVisible,e._e())])},s=[],i=a("37b8"),r=a("3f88"),c=a("90b9"),o=a("729c"),n=(a("c9f4"),a("591a"),a("f24a")),d=a.n(n),p=(a("b881"),{name:"advertisement",components:{Edio:i["a"],VueUeditorWrap:d.a,myEditor:r["a"]},data(){return{dialogVisible1:!1,PeojectListvalue1:"",carouselList:[],uploadImgUrl:"",options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"}],value:["2019-04-17 05:00:00","2019-04-17 12:00:59"],value1:[],radio2:1,tableData:[],currentPage:1,pageSize:10,total:0,PeojectListvalue:"",dialogVisible:!1,serchstartend:null,oThisData:{},cellData:{advertise:{orgIds:[]},imgFile:{id:"",thumb_1:"",thumb_2:"",url:""},orgList:[{}]},serchtitle:"",serchstate:"",states:[],fileList:[],msg:"请输入，1(含)~10000个字以内(含)，不限图片张数",myConfig:{autoHeightEnabled:!1,initialFrameHeight:480,initialFrameWidth:"100%",serverUrl:"http://35.201.165.105:8000/controller.php",UEDITOR_HOME_URL:"UEditor/"},TimeStartandEnd:null,ByLocation:0,form:{name:""},param:"",ModeTitle:"",project:[]}},computed:{},created(){this.init()},mounted(){},methods:{removeUploadImgOrigin(e){this.cellData.imgFile.thumb_1="",this.cellData.imgFile.id="",this.cellData.imgFile.url=""},async ModifyAdve(){let e=this;if(""===e.cellData.advertise.title)return void e.$message({showClose:!0,message:"广告标题不能为空",type:"warning"});if(e.cellData.advertise.cityIds.length<=0)return void e.$message({showClose:!0,message:"发布城市不能为空",type:"warning"});if(null===e.TimeStartandEnd)return void e.$message({showClose:!0,message:"上线时段不能为空",type:"warning"});if(""===e.cellData.advertise.place)return void e.$message({showClose:!0,message:"轮播位置不能为空",type:"warning"});if(""===e.cellData.advertise.type)return void e.$message({showClose:!0,message:"内容类型不能为空",type:"warning"});if(""===e.cellData.imgFile.url)return void e.$message({showClose:!0,message:"图片不能为空",type:"warning"});if(0===e.cellData.advertise.type&&!e.$refs.editor.editorVal)return void e.$message({showClose:!0,message:"内容不能为空",type:"warning"});if(1===e.cellData.advertise.type&&!e.cellData.advertise.url)return void e.$message({showClose:!0,message:"网址不能为空",type:"warning"});let t=JSON.parse(JSON.stringify(e.cellData.advertise.cityIds));t=t.join(",");let a={title:Object(c["m"])(e.cellData.advertise.title),startTime:"",endTime:"",place:e.cellData.advertise.place,type:e.cellData.advertise.type,content:e.$refs.editor.editorVal||"",url:e.cellData.advertise.url,cityIds:t};if(e.cellData.imgFile.id?a.fileIds=e.cellData.imgFile.id:a.fileIds="",e.TimeStartandEnd&&(a.startTime=Object(c["j"])(e.TimeStartandEnd[0]),a.endTime=Object(c["j"])(e.TimeStartandEnd[1])),"修改广告"===e.ModeTitle){a.id=e.cellData.advertise.id;let t=await Object(o["w"])(a);t.data.result&&(e.getAdvertisePage(),e.$message({showClose:!0,message:t.data.message,type:"success"}))}else if("新增广告"===e.ModeTitle){let t=await Object(o["c"])(a);t.data.result&&(e.getAdvertisePage(),e.$message({showClose:!0,message:t.data.message,type:"success"}))}e.dialogVisible1=!1},success(e){const t=e.size/1024/1024<=3;if(!t)return this.$message({message:"上传图片大小不能超过 3MB!",type:"error"});let a=new FormData;a.append("file",e),this.$http({method:"post",url:"./api/file/uploadthumbCompress",data:a}).then(e=>{this.$set(this.cellData.imgFile,"id",e.data.data.id),this.$set(this.cellData.imgFile,"thumb_1",e.data.data.thumb_1),this.$set(this.cellData.imgFile,"thumb_2",e.data.data.thumb_2),this.$set(this.cellData.imgFile,"url",e.data.data.url)})},getAdvertiseStates(){try{Object(o["P"])().then(e=>{this.states=e.data.data})}catch(e){}},getAdvertiseView(e){let t=this;try{if("upde"===e){t.ModeTitle="修改广告",t.cellData.imgFile={id:"",thumb_1:"",thumb_2:"",url:""};let e={id:t.oThisData.id};Object(o["Q"])(e).then(e=>{t.cellData.imgFile=e.data.data.imgFile?e.data.data.imgFile:{},e.data.data.advertise.cityIds=e.data.data.advertise.cityIds.split(","),e.data.data.advertise.cityIds.map((t,a,l)=>{e.data.data.advertise.cityIds[a]=parseInt(t)}),t.cellData.advertise=e.data.data.advertise,t.cellData.orgList=e.data.data.orgList,t.TimeStartandEnd=[t.cellData.advertise.startTime,t.cellData.advertise.endTime],t.dialogVisible1=!0,t.$nextTick(function(){t.$refs.editor.editorinit(t.$refs.editor.$refs.editor)})})}else t.$set(t.cellData.advertise,"title",""),t.cellData.advertise.orgIds=[],t.$set(t.cellData.advertise,"type",0),t.$set(t.cellData,"imgFile",{}),t.$set(t.cellData.imgFile,"url",""),t.TimeStartandEnd=null,t.$set(t.cellData.advertise,"place",1),t.$set(t.cellData.advertise,"content",""),t.ModeTitle="新增广告",t.dialogVisible1=!0,t.$nextTick(function(){t.$refs.editor.editorinit(t.$refs.editor.$refs.editor)})}catch(a){console.log(a)}},cellclick(e,t,a,l){this.oThisData=e,console.log(e,t,a,l),"修改"==l.target.innerHTML&&this.getAdvertiseView("upde")},getAdvertisePlaces(){try{Object(o["O"])().then(e=>{this.carouselList=e.data.data})}catch(e){}},getProjects(){this.$store.state.projectList.length<=0&&Object(o["mb"])().then(e=>{e.data.result&&this.$store.commit("setProject",e.data.data)})},getAdvertisePage(){if(!this.PeojectListvalue)return;let e={currentPage:this.currentPage,pageSize:this.pageSize,cityId:this.PeojectListvalue,startCreateTime:"",endCreateTime:"",state:this.serchstate,title:Object(c["m"])(this.serchtitle)};null!=this.serchstartend?(e.startCreateTime=this.serchstartend[0],e.endCreateTime=this.serchstartend[1]):(e.startCreateTime="",e.endCreateTime="");try{Object(o["N"])(e).then(e=>{this.tableData=JSON.parse(JSON.stringify(e.data.data.content)),this.total=e.data.data.total})}catch(t){console.log(t)}},getproj(){this.$http.get("/api/org/GetValidCity").then(e=>{this.project=e.data.data,this.PeojectListvalue=this.project.length>0?this.project[0].id:""}).then(()=>{this.getAdvertisePage(),this.getAdvertiseStates(),this.getAdvertisePlaces()}).catch(e=>{console.log(e)})},init(){this.getproj()},handleSizeChange(e){this.currentPage=1,this.pageSize=e,this.getAdvertisePage(),console.log(`每页 ${e} 条`)},handleCurrentChange(e){this.currentPage=e,this.getAdvertisePage(),console.log(`当前页: ${e}`)}}}),u=p,h=(a("fcc0"),a("6691")),g=Object(h["a"])(u,l,s,!1,null,null,null);t["default"]=g.exports},"47b5":function(e,t,a){},fcc0:function(e,t,a){"use strict";var l=a("47b5"),s=a.n(l);s.a}}]);